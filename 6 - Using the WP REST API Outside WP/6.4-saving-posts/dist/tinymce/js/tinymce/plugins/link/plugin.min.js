!function(){var a={},b=function(b){for(var c=a[b],e=c.deps,f=c.defn,g=e.length,h=new Array(g),i=0;i<g;++i)h[i]=d(e[i]);var j=f.apply(null,h);if(void 0===j)throw"module ["+b+"] returned undefined";c.instance=j},c=function(b,c,d){if("string"!=typeof b)throw"module id must be a string";if(void 0===c)throw"no dependencies for "+b;if(void 0===d)throw"no definition function for "+b;a[b]={deps:c,defn:d,instance:void 0}},d=function(c){var d=a[c];if(void 0===d)throw"module ["+c+"] was undefined";return void 0===d.instance&&b(c),d.instance},e=function(a,b){for(var c=a.length,e=new Array(c),f=0;f<c;++f)e.push(d(a[f]));b.apply(null,b)},f={};f.bolt={module:{api:{define:c,require:e,demand:d}}};var g=c,h=function(a,b){g(a,[],function(){return b})};h("9",tinymce.util.Tools.resolve),g("1",["9"],function(a){return a("tinymce.PluginManager")}),g("2",["9"],function(a){return a("tinymce.util.Tools")}),g("3",["9"],function(a){return a("tinymce.Env")}),g("4",["9"],function(a){return a("tinymce.dom.DOMUtils")}),g("5",["9"],function(a){return a("tinymce.util.XHR")}),g("6",["9"],function(a){return a("tinymce.util.JSON")}),g("7",["9"],function(a){return a("tinymce.util.Delay")}),g("8",["9"],function(a){return a("tinymce.util.VK")}),g("0",["1","2","3","4","5","6","7","8"],function(a,b,c,d,e,f,g,h){return a.add("link",function(a){function i(a){return a&&"A"===a.nodeName&&a.href}function j(a){return b.grep(a,i).length>0}function k(b){return a.dom.getParent(b,"a[href]")}function l(){return k(a.selection.getStart())}function m(a){var b=a.getAttribute("data-mce-href");return b?b:a.getAttribute("href")}function n(){var b=a.plugins.contextmenu;return!!b&&b.isContextMenuVisible()}function o(b){var c,d,e;return!!(a.settings.link_context_toolbar&&!n()&&i(b)&&(c=a.selection,d=c.getRng(),e=d.startContainer,3==e.nodeType&&c.isCollapsed()&&d.startOffset>0&&d.startOffset<e.data.length))}function p(a,b){document.body.appendChild(a),a.dispatchEvent(b),document.body.removeChild(a)}function q(a){if(!c.ie||c.ie>10){var b=document.createElement("a");b.target="_blank",b.href=a,b.rel="noreferrer noopener";var e=document.createEvent("MouseEvents");e.initMouseEvent("click",!0,!0,window,0,0,0,0,0,!1,!1,!1,!1,0,null),p(b,e)}else{var f=window.open("","_blank");if(f){f.opener=null;var g=f.document;g.open(),g.write('<meta http-equiv="refresh" content="0; url='+d.DOM.encode(a)+'">'),g.close()}}}function r(b){if(b){var c=m(b);if(/^#/.test(c)){var d=a.$(c);d.length&&a.selection.scrollIntoView(d[0],!0)}else q(b.href)}}function s(){r(l())}function t(){var b=this,c=function(a){j(a.parents)?b.show():b.hide()};j(a.dom.getParents(a.selection.getStart()))||b.hide(),a.on("nodechange",c),b.on("remove",function(){a.off("nodechange",c)})}function u(b){return function(){var c=a.settings.link_list;"string"==typeof c?e.send({url:c,success:function(a){b(f.parse(a))}}):"function"==typeof c?c(b):b(c)}}function v(a,c,d){function e(a,d){return d=d||[],b.each(a,function(a){var b={text:a.text||a.title};a.menu?b.menu=e(a.menu):(b.value=a.value,c&&c(b)),d.push(b)}),d}return e(a,d||[])}function w(c){function d(a){var b=n.find("#text");(!b.value()||a.lastControl&&b.value()==a.lastControl.text())&&b.value(a.control.text()),n.find("#href").value(a.control.value())}function e(c){var e=[];if(b.each(a.dom.select("a:not([href])"),function(a){var b=a.name||a.id;b&&e.push({text:b,value:"#"+b,selected:c.indexOf("#"+b)!=-1})}),e.length)return e.unshift({text:"None",value:""}),{name:"anchor",type:"listbox",label:"Anchors",values:e,onselect:d}}function f(){!m&&0===y.text.length&&o&&this.parent().parent().find("#text")[0].value(this.value())}function h(c){var d=c.meta||{};q&&q.value(a.convertURL(this.value(),"href")),b.each(c.meta,function(a,b){var c=n.find("#"+b);"text"===b?0===m.length&&(c.value(a),y.text=a):c.value(a)}),d.attach&&(x={href:this.value(),attach:d.attach}),d.text||f.call(this)}function i(a){var b=z.getContent();if(/</.test(b)&&(!/^<a [^>]+>[^<]+<\/a>$/.test(b)||b.indexOf("href=")==-1))return!1;if(a){var c,d=a.childNodes;if(0===d.length)return!1;for(c=d.length-1;c>=0;c--)if(3!=d[c].nodeType)return!1}return!0}function j(a){a.meta=n.toJSON()}var k,l,m,n,o,p,q,r,s,t,u,w,y={},z=a.selection,A=a.dom;k=z.getNode(),l=A.getParent(k,"a[href]"),o=i(),y.text=m=l?l.innerText||l.textContent:z.getContent({format:"text"}),y.href=l?A.getAttrib(l,"href"):"",l?y.target=A.getAttrib(l,"target"):a.settings.default_link_target&&(y.target=a.settings.default_link_target),(w=A.getAttrib(l,"rel"))&&(y.rel=w),(w=A.getAttrib(l,"class"))&&(y["class"]=w),(w=A.getAttrib(l,"title"))&&(y.title=w),o&&(p={name:"text",type:"textbox",size:40,label:"Text to display",onchange:function(){y.text=this.value()}}),c&&(q={type:"listbox",label:"Link list",values:v(c,function(b){b.value=a.convertURL(b.value||b.url,"href")},[{text:"None",value:""}]),onselect:d,value:a.convertURL(y.href,"href"),onPostRender:function(){q=this}}),a.settings.target_list!==!1&&(a.settings.target_list||(a.settings.target_list=[{text:"None",value:""},{text:"New window",value:"_blank"}]),s={name:"target",type:"listbox",label:"Target",values:v(a.settings.target_list)}),a.settings.rel_list&&(r={name:"rel",type:"listbox",label:"Rel",values:v(a.settings.rel_list)}),a.settings.link_class_list&&(t={name:"class",type:"listbox",label:"Class",values:v(a.settings.link_class_list,function(b){b.value&&(b.textStyle=function(){return a.formatter.getCssText({inline:"a",classes:[b.value]})})})}),a.settings.link_title!==!1&&(u={name:"title",type:"textbox",label:"Title",value:y.title}),n=a.windowManager.open({title:"Insert link",data:y,body:[{name:"href",type:"filepicker",filetype:"file",size:40,autofocus:!0,label:"Url",onchange:h,onkeyup:f,onbeforecall:j},p,u,e(y.href),q,r,s,t],onSubmit:function(c){function d(b,c){var d=a.selection.getRng();g.setEditorTimeout(a,function(){a.windowManager.confirm(b,function(b){a.selection.setRng(d),c(b)})})}function e(a,c){function d(a){return a=e(a),a?[a,f].join(" "):f}function e(a){var c=new RegExp("("+f.replace(" ","|")+")","g");return a&&(a=b.trim(a.replace(c,""))),a?a:null}var f="noopener noreferrer";return c?d(a):e(a)}function f(){var b={href:i,target:y.target?y.target:null,rel:y.rel?y.rel:null,"class":y["class"]?y["class"]:null,title:y.title?y.title:null};a.settings.allow_unsafe_link_target||(b.rel=e(b.rel,"_blank"==b.target)),i===x.href&&(x.attach(),x={}),l?(a.focus(),o&&y.text!=m&&("innerText"in l?l.innerText=y.text:l.textContent=y.text),A.setAttribs(l,b),z.select(l),a.undoManager.add()):o?a.insertContent(A.createHTML("a",b,A.encode(y.text))):a.execCommand("mceInsertLink",!1,b)}function h(){a.undoManager.transact(f)}var i;return y=b.extend(y,c.data),(i=y.href)?i.indexOf("@")>0&&i.indexOf("//")==-1&&i.indexOf("mailto:")==-1?void d("The URL you entered seems to be an email address. Do you want to add the required mailto: prefix?",function(a){a&&(i="mailto:"+i),h()}):a.settings.link_assume_external_targets&&!/^\w+:/i.test(i)||!a.settings.link_assume_external_targets&&/^\s*www[\.|\d\.]/i.test(i)?void d("The URL you entered seems to be an external link. Do you want to add the required http:// prefix?",function(a){a&&(i="http://"+i),h()}):void h():void a.execCommand("unlink")}})}var x={},y=function(a){return a.altKey===!0&&a.shiftKey===!1&&a.ctrlKey===!1&&a.metaKey===!1};a.addButton("link",{icon:"link",tooltip:"Insert/edit link",shortcut:"Meta+K",onclick:u(w),stateSelector:"a[href]"}),a.addButton("unlink",{icon:"unlink",tooltip:"Remove link",cmd:"unlink",stateSelector:"a[href]"}),a.addContextToolbar&&(a.addButton("openlink",{icon:"newtab",tooltip:"Open link",onclick:s}),a.addContextToolbar(o,"openlink | link unlink")),a.addShortcut("Meta+K","",u(w)),a.addCommand("mceLink",u(w)),a.on("click",function(a){var b=k(a.target);b&&h.metaKeyPressed(a)&&(a.preventDefault(),r(b))}),a.on("keydown",function(a){var b=l();b&&13===a.keyCode&&y(a)&&(a.preventDefault(),r(b))}),this.showDialog=w,a.addMenuItem("openlink",{text:"Open link",icon:"newtab",onclick:s,onPostRender:t,prependToContext:!0}),a.addMenuItem("link",{icon:"link",text:"Link",shortcut:"Meta+K",onclick:u(w),stateSelector:"a[href]",context:"insert",prependToContext:!0})}),function(){}}),d("0")()}();